<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Generador de Números Aleatorios</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <style>
      body {
        padding: 20px;
      }
      .loader,
      .pagination-loader {
        border: 6px solid #f3f3f3;
        border-radius: 50%;
        border-top: 6px solid #3498db;
        width: 60px;
        height: 60px;
        animation: spin 2s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .hidden {
        display: none;
      }
      .significant {
        color: red;
      }
      .not-significant {
        color: green;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Generador de Números Aleatorios</h2>
      <p>
        Seleccione una distribución y parámetros para definir la hipótesis nula
        (H0) de cómo se distribuyen los datos generados.
      </p>
      <form id="dataForm">
        <div class="form-group">
          <label for="sampleSize">Tamaño de Muestra (N):</label>
          <input
            type="number"
            id="sampleSize"
            value="1000"
            class="form-control"
          />
        </div>
        <div class="form-group">
          <label for="distribucion">Distribución:</label>
          <select
            id="distribucion"
            class="form-control"
            onchange="updateParameters();"
          >
            <option value="uniforme">Uniforme</option>
            <option value="exponencial">Exponencial</option>
            <option value="normal">Normal</option>
          </select>
        </div>
        <div id="params"></div>
        <div class="form-group">
          <label for="numBins">Cantidad de intervalos:</label>
          <select id="numBins" class="form-control">
            <option value="10">10</option>
            <option value="12">12</option>
            <option value="16">16</option>
            <option value="23">23</option>
          </select>
        </div>
        <button
          type="button"
          class="btn btn-primary"
          onclick="generarNumeros()"
        >
          Generar
        </button>
      </form>
      <div id="loading" class="loader hidden" style="margin-top: 20px"></div>
      <div id="results" class="hidden">
      <h3>Resultados</h3>
      <img
        id="histogram"
        src=""
        class="img-fluid hidden"
      />
      <p>
        Chi-cuadrado Estadístico: <span id="chiSquareStat"></span> (<span
          id="chiResult"
        ></span
        >)
      </p>
      <p>Chi-cuadrado P-Valor: <span id="chiSquareP" class=""></span></p>
      <p>
        Kolmogorov-Smirnov Estadístico: <span id="kolmogorovStat"></span> (<span
          id="ksResult"
        ></span
        >)
      </p>
      <p>Kolmogorov-Smirnov P-Valor: <span id="kolmogorovP" class=""></span></p>
    </div>
      <div id="summaryTable" class="hidden">
        <h4>Resumen de los números generados</h4>
        <table class="table">
          <tbody>
            <tr>
              <td>N: Tamaño de la muestra</td>
              <td id="tableSampleSize"></td>
            </tr>
            <tr>
              <td>Min:</td>
              <td id="tableMin"></td>
            </tr>
            <tr>
              <td>Max:</td>
              <td id="tableMax"></td>
            </tr>
            <tr>
              <td>Rango:</td>
              <td id="tableRange"></td>
            </tr>
            <tr>
              <td>Cantidad de intervalos:</td>
              <td id="tableBins"></td>
            </tr>
            <tr>
              <td>Amplitud de intervalos:</td>
              <td id="tableAmplitude"></td>
            </tr>
            <tr>
              <td>Media:</td>
              <td id="tableMean"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div id="dataViewer" class="hidden">
        <h4>Números Generados</h4>
        <table class="table table-striped">
          <thead>
            <tr>
              <th>#</th>
              <th>Valor</th>
            </tr>
          </thead>
          <tbody id="dataBody"></tbody>
        </table>
        <nav aria-label="Page navigation example">
          <ul class="pagination">
            <li class="page-item">
              <a class="page-link" href="#" onclick="changePage(-1)"
                >Anterior</a
              >
            </li>
            <li class="page-item">
              <a class="page-link" href="#" onclick="changePage(1)"
                >Siguiente</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <script>
      let currentPage = 0;
      let numPerPage = 100;
      let generatedData = [];

      function updateParameters() {
        var distribucion = $("#distribucion").val();
        var paramsHTML = "";
        if (distribucion === "uniforme") {
          paramsHTML =
            '<div class="form-group"><label for="param1">a (Límite inferior):</label><input type="number" id="param1" value="0" class="form-control"></div>' +
            '<div class="form-group"><label for="param2">b (Límite superior):</label><input type="number" id="param2" value="1" class="form-control"></div>';
        } else if (distribucion === "exponencial") {
          paramsHTML =
            '<div class="form-group"><label for="param1">Lambda (λ):</label><input type="number" id="param1" value="1" class="form-control"></div>';
        } else if (distribucion === "normal") {
          paramsHTML =
            '<div class="form-group"><label for="param1">Mu (μ, Media):</label><input type="number" id="param1" value="0" class="form-control"></div>' +
            '<div class="form-group"><label for="param2">Sigma (σ, Desviación Estándar):</label><input type="number" id="param2" value="1" class="form-control"></div>';
        }
        $("#params").html(paramsHTML);
      }

      function generarNumeros() {
        $("#loading").removeClass("hidden");
        var sampleSize = $("#sampleSize").val();
        var distribucion = $("#distribucion").val();
        var param1 = $("#param1").val();
        var param2 = $("#param2").val();
        var numBins = $("#numBins").val();
        var params = {};

        if (distribucion === "uniforme" || distribucion === "normal") {
          params["a"] = param1;
          params["b"] = param2;
        } else if (distribucion === "exponencial") {
          params["lambda"] = param1;
        }

        $.ajax({
          type: "POST",
          url: "/generate",
          contentType: "application/json",
          data: JSON.stringify({
            muestra: sampleSize,
            distribucion: distribucion,
            params: params,
            intervalos: numBins
          }),
          success: function (response) {
            if (response.error) {
              alert(response.error); // Show error if there is an error field in response
              $("#loading").addClass("hidden");
            } else {
              $("#histogram").attr("src", response.histogram);
              $("#chiSquareStat").text(response.chi_square_stat);
              $("#chiSquareP").text(response.chi_square_p);
              $("#kolmogorovStat").text(response.kolmogorovStat);
              $("#kolmogorovP").text(response.kolmogorovP);
              $("#chiResult")
                .text(
                  response.chi_Square_P < 0.05
                    ? "Rechazar H0"
                    : "No rechazar H0"
                )
                .addClass(
                  response.chi_square_p < 0.05
                    ? "significant"
                    : "not-significant"
                );
              $("#ksResult")
                .text(
                  response.kolmogorovP < 0.05
                    ? "Rechazar H0"
                    : "No rechazar H0"
                )
                .addClass(
                  response.kolmogorovP < 0.05
                    ? "significant"
                    : "not-significant"
                );
              $("#loading").addClass("hidden");
              updateTable(response.data);
              $("#dataViewer").removeClass("hidden");
              $("#results").removeClass("hidden");
              $("#histogram").removeClass("hidden");              
              $("#tableSampleSize").text(response.sample_size);
              $("#tableMin").text(response.min);
              $("#tableMax").text(response.max);
              $("#tableRange").text(response.range);
              $("#tableBins").text(response.number_of_bins);
              $("#tableAmplitude").text(response.bin_amplitude);
              $("#tableMean").text(response.mean);
              $("#summaryTable").removeClass("hidden");
            }
          },
          error: function (xhr, textStatus, errorThrown) {
            alert("Hubo un error: " + xhr.responseText);
            $("#loading").addClass("hidden");
          }
        });
      }

      function updateTable(data) {
        generatedData = data;
        currentPage = 0;
        renderPage();
      }

      function renderPage() {
        let start = currentPage * numPerPage;
        let end = start + numPerPage;
        let slicedData = generatedData.slice(start, end);
        let tableBody = slicedData
          .map(
            (value, index) =>
              `<tr><td>${start + index + 1}</td><td>${value}</td></tr>`
          )
          .join("");
        $("#dataBody").html(tableBody);
      }

      function changePage(dir) {
        let nextPage = currentPage + dir;
        let totalPages = Math.ceil(generatedData.length / numPerPage);
        if (nextPage >= 0 && nextPage < totalPages) {
          currentPage = nextPage;
          renderPage();
        }
      }

      updateParameters();
    </script>
  </body>
</html>
